<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        /* Elimina animación global de entrada para esta página */
        body { animation: none !important; }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Team - Eftimos</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon_io/eaf_white-outline.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon_io/eaf_white-outline.png">
    <link rel="manifest" href="assets/images/favicon_io/site.webmanifest">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/favicon_io/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/favicon_io/android-chrome-512x512.png">

    <meta name="description"
        content="Meet the creative minds behind Eaftimos - visionaries, artists, and craftspeople.">
    <meta name="keywords"
        content="Eaftimos, team, creative director, designers, fashion team, creative minds">

    <!-- Preload critical fonts -->
    <link rel="preload" href="assets/fonts/Helvetica.ttf" as="font" type="font/ttf" crossorigin>

    <!-- Preload critical CSS -->
    <link rel="stylesheet" href="assets/css/style.css">

    <!-- DNS prefetch for faster resource loading -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">

    <!-- Mostrar menú lateral solo cuando el menú está abierto -->
    <style>
        body.menu-open #dropdownMenu {
            transform: translateX(0) !important;
        }
        body.menu-open #dropdownMenu::before {
            transform: translateX(0) !important;
            pointer-events: all !important;
        }

        /* Estilos para la galería */
        body {
            overflow: hidden;
            background-color: #000;
        }

        /* Video de fondo */
        #videos-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 0;
            overflow: hidden;
            background-color: #000;
        }

        #videos-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            transform: translate(-50%, -50%);
            object-fit: cover;
            opacity: 0.1;
        }

        .gallery-container {
            position: fixed;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: auto;
            max-width: 90vw;
            max-height: calc(100vh - 200px);
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Galería de imágenes estilo Tinder */
        .gallery-wrapper {
            position: relative;
            width: auto;
            max-width: 90vw;
            max-height: calc(100vh - 200px);
            perspective: 1000px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 100px;
            margin-top: 70px;
        }

        .gallery-track {
            position: relative;
            width: 420px;
            height: 600px;
        }

        .gallery-card {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 420px;
            height: 600px;
            border-radius: 12px;
            overflow: visible;
            background: transparent;
            transition: transform 0.35s cubic-bezier(0.34, 1.2, 0.64, 1),
                        opacity 0.35s cubic-bezier(0.34, 1.2, 0.64, 1),
                        filter 0.35s cubic-bezier(0.34, 1.2, 0.64, 1);
            will-change: transform, opacity, filter;
            perspective: 1500px;
        }

        /* Contenedor interno para el flip */
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .gallery-card.flipped .card-inner {
            transform: rotateY(180deg);
            cursor: default;
        }

        /* Caras de la tarjeta */
        .card-front,
        .card-back {
            position: relative;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 12px;
            overflow: hidden;
            mix-blend-mode: difference;
        }

        .card-back {
            position: absolute;
            top: 0;
            left: 0;
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
        }

        /* Estilo para el scrollbar del card-back */
        .card-back::-webkit-scrollbar {
            width: 4px;
        }

        .card-back::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .card-back::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        .card-back::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .card-back-content {
            color: #fff;
            text-align: center;
            max-width: 90%;
        }

        .card-back-title {
            font-family: 'Helvetica Neue Condensed Bold', 'Helvetica', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .card-back-bio {
            font-family: 'Helvetica', sans-serif;
            font-size: 0.9rem;
            line-height: 1.6;
            letter-spacing: 0.3px;
            margin-bottom: 1.5rem;
            color: rgba(255, 255, 255, 0.85);
        }

        .card-back-details {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            text-align: left;
            width: 100%;
        }

        .card-back-detail {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            font-family: 'Helvetica', sans-serif;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .card-back-detail-label {
            color: rgba(255, 255, 255, 0.6);
            min-width: 80px;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
        }

        .card-back-detail-value {
            color: rgba(255, 255, 255, 0.9);
            flex: 1;
        }

        .flip-button {
            padding: 0.6rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-family: 'Helvetica Neue Condensed Bold', 'Helvetica', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .flip-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Prevenir interacción con las caras que no están visibles */
        .card-front {
            pointer-events: auto;
        }

        .gallery-card.flipped .card-front {
            pointer-events: none;
        }

        .card-back {
            pointer-events: none;
        }

        .gallery-card.flipped .card-back {
            pointer-events: auto;
        }
        
        .gallery-card.active {
            cursor: grab;
        }

        .gallery-card.active.flipped {
            cursor: default;
        }
        
        .gallery-card.dragging {
            cursor: grabbing !important;
            transition: none;
        }
        
        .gallery-card.zoomed {
            cursor: grab;
        }
        
        .gallery-card.zoomed.dragging {
            cursor: grabbing !important;
        }

        .gallery-card.active {
            z-index: 10;
            opacity: 1;
            filter: blur(0px);
            transform: translate(-50%, -50%) scale(1.05);
        }

        .gallery-card.next {
            z-index: 9;
            opacity: 0.7;
            filter: blur(2px);
            transform: translate(-50%, -50%) scale(0.95) translateY(20px);
        }

        .gallery-card.hidden {
            z-index: 1;
            opacity: 0;
            filter: blur(8px);
            transform: translate(-50%, -50%) scale(0.85) translateY(40px);
            pointer-events: none;
        }

        .gallery-card.returning {
            transition: transform 0.35s cubic-bezier(0.34, 1.4, 0.64, 1) !important;
        }

        .gallery-card.zoomed {
            cursor: zoom-out;
        }

        .gallery-card.swiping-left {
            transform: translate(-50%, -50%) translateX(-150%) rotate(-20deg) !important;
            opacity: 0 !important;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.25s cubic-bezier(0.4, 0, 1, 1) 0.15s !important;
        }

        .gallery-card.swiping-right {
            transform: translate(-50%, -50%) translateX(150%) rotate(20deg) !important;
            opacity: 0 !important;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.25s cubic-bezier(0.4, 0, 1, 1) 0.15s !important;
        }

        .gallery-card.coming-from-back {
            z-index: 1 !important;
            transform: translate(-50%, -50%) translateX(-180px) scale(0.85) rotate(-15deg) !important;
            opacity: 0.75 !important;
            transition: none !important;
        }

        .gallery-card.coming-from-back.moving-forward {
            z-index: 100 !important;
            transform: translate(-50%, -50%) translateX(0) scale(1.05) rotate(0deg) !important;
            opacity: 1 !important;
            transition: transform 0.5s cubic-bezier(0.34, 1.15, 0.64, 1), opacity 0.5s ease, z-index 0s !important;
        }

        .gallery-card.moving-to-back {
            z-index: 5 !important;
            transform: translate(-50%, -50%) scale(0.95) !important;
            opacity: 0.7 !important;
            transition: transform 0.5s cubic-bezier(0.34, 1.15, 0.64, 1), opacity 0.5s ease, z-index 0s 0.1s !important;
        }

        .gallery-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            display: block;
            user-select: none;
            -webkit-user-select: none;
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
            pointer-events: none;
            transition: transform 0.3s ease;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
        }

        /* Reducir tamaño en desktop */
        @media (min-width: 768px) {
            .gallery-card img {
                width: 100%;
                height: 100%;
            }
            
            .gallery-card {
                width: 420px;
                height: 600px;
            }
            
            .gallery-wrapper {
                max-width: 420px;
            }

            .card-back {
                max-height: calc(100vh - 250px);
            }
        }

        /* Caption sobre la imagen con degradado */
        .card-info-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.7) 50%, transparent);
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            z-index: 5;
            pointer-events: auto;
            transition: opacity 0.3s ease;
        }

        .card-title {
            color: #fff;
            font-family: 'Helvetica Neue Condensed Bold', 'Helvetica', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .card-description {
            color: rgba(255, 255, 255, 0.8);
            font-family: 'Helvetica', sans-serif;
            font-size: 0.85rem;
            line-height: 1.4;
            letter-spacing: 0.3px;
            margin-bottom: 1rem;
        }

        .card-social-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .social-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            text-decoration: none;
            pointer-events: auto;
        }

        .social-link:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .social-link svg {
            width: 16px;
            height: 16px;
            fill: #fff;
        }

        /* Controles de navegación - OCULTOS */
        .gallery-controls {
            display: none;
        }

        /* Overlay de textos animados - Estilo parallax-title */
        .card-overlay-words {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 20;
            pointer-events: none;
            overflow: visible;
            opacity: 0;
            transition: opacity 0.6s ease;
        }

        .gallery-card.active .card-overlay-words {
            opacity: 1;
        }

        .gallery-card.flipped .card-overlay-words {
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .overlay-word {
            position: absolute;
            font-family: 'Tangerine', 'Times New Roman', serif;
            font-size: 6rem;
            font-weight: bold;
            color: transparent;
            -webkit-text-stroke: 0.2px #ffffff;
            text-stroke: 0.2px #ffffff;
            mix-blend-mode: difference;
            white-space: nowrap;
            will-change: transform, filter, opacity;
            opacity: 0;
            filter: blur(0px);
            transition: opacity 1.4s ease, filter 1.4s ease;
            line-height: 1;
            text-transform: lowercase;
        }

        .card-overlay-words .overlay-word:nth-child(1) { top: 18%; left: 10%; }
        .card-overlay-words .overlay-word:nth-child(2) { top: 40%; right: 8%; }
        .card-overlay-words .overlay-word:nth-child(3) { top: 62%; left: 12%; }
        .card-overlay-words .overlay-word:nth-child(4) { top: 28%; right: 15%; }
        .card-overlay-words .overlay-word:nth-child(5) { bottom: 15%; right: 10%; }

        .overlay-word.active {
            opacity: 1;
            filter: blur(0px);
        }

        .overlay-word.fading {
            opacity: 0;
            filter: blur(0px);
            transition: opacity 1.4s ease;
        }

        /* Sección de descripción de colección */
        /* Sección de descripción de colección */
        .collection-info {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            padding: 2rem 2rem;
            background: transparent;
            z-index: 5;
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .collection-info.hidden {
            opacity: 0;
            transform: translateY(-20px);
        }

        .collection-description {
            max-width: 800px;
            margin: 0 auto;
            color: #fff;
            font-family: 'Helvetica Neue Condensed Bold', 'Helvetica', sans-serif;
            font-size: 0.95rem;
            line-height: 1.8;
            letter-spacing: 0.5px;
            text-align: center;
            opacity: 0.8;
        }

        .progress-indicator.hidden {
            opacity: 0;
            transform: translate(20px, -50%);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        
        /* Indicador de progreso */
        .progress-indicator {
            position: fixed;
            top: 50%;
            right: 2rem;
            transform: translateY(-50%);
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 15;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.5);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .gallery-container {
                max-width: 95vw;
                max-height: calc(100vh - 250px);
            }

            .gallery-wrapper {
                max-width: 95vw;
                margin-bottom: 80px;
            }

            .gallery-track {
                width: 85vw;
                height: min(75vh, 550px);
            }

            .gallery-card {
                width: 85vw;
                height: min(75vh, 550px);
            }

            .gallery-card img {
                width: 100%;
                height: 100%;
            }

            .overlay-word {
                font-size: 3.5rem;
            }

            .card-overlay-words .overlay-word:nth-child(1) { top: 15%; left: 5%; }
            .card-overlay-words .overlay-word:nth-child(2) { top: 38%; right: 5%; }
            .card-overlay-words .overlay-word:nth-child(3) { top: 60%; left: 8%; }
            .card-overlay-words .overlay-word:nth-child(4) { top: 25%; right: 10%; }
            .card-overlay-words .overlay-word:nth-child(5) { bottom: 18%; right: 6%; }

            .card-title {
                font-size: 1.1rem;
            }

            .card-description {
                font-size: 0.8rem;
            }

            .card-info-overlay {
                padding: 1.5rem 1rem 1rem 1rem;
            }

            .card-back {
                padding: 1.5rem;
            }

            .card-back-title {
                font-size: 1rem;
                margin-bottom: 1rem;
            }

            .card-back-bio {
                font-size: 0.8rem;
                margin-bottom: 1rem;
            }

            .card-back-detail {
                font-size: 0.75rem;
            }

            .card-back-details {
                gap: 0.6rem;
                margin-bottom: 1rem;
            }

            .collection-description {
                font-size: 0.85rem;
                padding: 0 1rem;
            }

            .progress-indicator {
                right: 1rem;
            }
        }
    </style>
</head>

<body style="background-color: #000;">
    <!-- Fade-in overlay blanco -->
    <div id="entryWhiteOverlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;z-index:999999;pointer-events:auto;transition:opacity 0.38s cubic-bezier(.77,0,.18,1);opacity:1;"></div>

    <!-- Page loader para cargas lentas -->
    <div id="pageLoader" class="page-loader page-loader-pending" aria-live="polite" aria-busy="true">
        <div class="page-loader-content preloader-content preloader-sober">
            <div class="preloader-bar-container">
                <div class="preloader-bar-bg hard-corner">
                    <div class="preloader-bar hard-corner page-loader-bar"></div>
                </div>
                <span class="preloader-bar-text page-loader-text">LOADING</span>
            </div>
        </div>
    </div>
    
    <!-- Grain Canvas -->
    <canvas id="grainCanvas" style="opacity: 0.005;"></canvas>

    <!-- Background Video -->
    <div id="videos-background">
        <video autoplay muted loop playsinline preload="none" poster="assets/images/logo-white.png">
            <source src="assets/vid/reels-mixed-vid.mp4" type="video/mp4">
        </video>
    </div>

    <nav class="blending-item">
        <div class="nav-container">
            <!-- Menu Hamburguesa -->
            <div class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <!-- Logo compartido con preloader -->
            <a href="index.html" class="logo shared-logo" data-shape="circle">
                <img src="assets/images/logo-white.png" alt="Eaftimos Logo" id="sharedLogo" width="150" height="auto"
                    draggable="false">
            </a>
        </div>

        <!-- Menú Desplegable -->
        <div class="dropdown-menu" id="dropdownMenu">
            <div class="menu-links">
                <a href="https://1peief-wi.myshopify.com/" target="_blank" rel="noopener noreferrer"
                    class="dropdown-link" data-shape="circle">SHOP</a>
                <div class="dropdown-item-with-submenu" style="display:none;">
                    <button class="dropdown-link dropdown-toggle" id="collectionsToggle">
                        COLLECTIONS
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" width="16" height="16" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="submenu" id="collectionsSubmenu">
                        <a href="#nierika" class="submenu-link">NIERIKA AW26</a>
                        <a href="gallery-view.html" class="submenu-link">RESiLiENCE AW24</a>
                    </div>
                </div>
                <div class="dropdown-item-with-submenu">
                    <button class="dropdown-link dropdown-toggle" id="socialMediaToggle">
                        SOCIAL MEDIA
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" width="16" height="16" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="submenu" id="socialMediaSubmenu">
                        <a href="https://www.instagram.com/eaftimos/" target="_blank" rel="noopener noreferrer" class="submenu-link">INSTAGRAM</a>
                        <a href="https://www.tiktok.com/@eaftimos" target="_blank" rel="noopener noreferrer" class="submenu-link">TIKTOK</a>
                    </div>
                </div>
                <button class="dropdown-link" id="contactBtn" data-shape="circle">CONTACT</button>
            </div>

            <!-- Control Icons in Sidebar -->
            <div class="sidebar-controls">
                <div class="sidebar-control-buttons">
                    <button class="sidebar-control-btn" id="visualToggle" title="Toggle Visual Effects">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <!-- Icono de ojo abierto -->
                            <path class="eye-open" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle class="eye-open" cx="12" cy="12" r="3"></circle>
                            <!-- Icono de ojo cerrado (oculto inicialmente) -->
                            <line class="eye-closed" style="display:none;" x1="1" y1="1" x2="23" y2="23"
                                stroke-linecap="round"></line>
                        </svg>
                    </button>
                    <button class="sidebar-control-btn" id="audioToggle" title="Toggle Audio">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <!-- Altavoz abierto -->
                            <path class="speaker-on" d="M3 9v6c0 1.105.895 2 2 2h4l5 5V4H9c-1.105 0-2 .895-2 2v3z">
                            </path>
                            <path class="speaker-on" d="M17.5 3.5a4 4 0 0 1 0 5.66M19.07 4.93a8 8 0 0 1 0 11.31"></path>
                            <!-- Altavoz mudo (oculto inicialmente) -->
                            <path class="speaker-off" style="display:none;" d="M11 5L6 9H2v6h4l5 5V5z"></path>
                            <line class="speaker-off" style="display:none;" x1="23" y1="9" x2="17" y2="15"></line>
                            <line class="speaker-off" style="display:none;" x1="17" y1="9" x2="23" y2="15"></line>
                        </svg>
                    </button>
                </div>
                <div class="control-status-message" id="statusMessage"></div>
            </div>
        </div>
    </nav>

    <!-- Contact Form Modal -->
    <div class="contact-modal" id="contactModal">
        <div class="contact-modal-content">
            <button class="contact-close" id="contactClose">&times;</button>
            <h2>CONTACT US</h2>
            <form id="contactForm" action="https://formsubmit.co/contact@eaftimos.com" method="POST">
                <!-- FormSubmit Configuration -->
                <input type="hidden" name="_subject" value="New contact from Eftimos Team">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_template" value="table">
                
                <div class="form-group">
                    <input type="text" id="name" name="name" placeholder="NAME" required data-shape="cross">
                </div>
                <div class="form-group">
                    <input type="email" id="email" name="email" placeholder="EMAIL" required data-shape="cross">
                </div>
                <div class="form-group">
                    <select id="queryType" name="queryType" required data-shape="cross">
                        <option value="" disabled selected>QUERY TYPE</option>
                        <option value="Atelier (Custom Clothing)">ATELIER (CUSTOM CLOTHING)</option>
                        <option value="Styling">STYLING</option>
                        <option value="Press">PRESS</option>
                        <option value="Social Media">SOCIAL MEDIA</option>
                        <option value="Other">OTHER</option>
                    </select>
                </div>
                <div class="form-group">
                    <textarea id="message" name="message" placeholder="MESSAGE" rows="5" required data-shape="cross"></textarea>
                </div>
                <button type="submit" class="submit-btn">SEND</button>
            </form>
        </div>
    </div>

    <main>
        <!-- Galería principal -->
        <div class="gallery-container">
            <div class="gallery-wrapper">
                <div class="gallery-track" id="galleryTrack">
                    <!-- Las tarjetas se generarán dinámicamente -->
                </div>
            </div>
        </div>

        <!-- Indicador de progreso -->
        <div class="progress-indicator" id="progressIndicator">
            <!-- Los puntos se generarán dinámicamente -->
        </div>

        <!-- Contenedor de overlay words (fuera de las cartas) -->
        <div id="overlayWordsContainer"></div>

        <!-- Sección de información de la colección -->
        <div class="collection-info">
            <div class="collection-description">
                <p>THE MINDS BEHIND EAFTIMOS — A COLLECTIVE OF VISIONARIES, CREATORS, AND CRAFTSPEOPLE UNITED BY PASSION. EACH VOICE DISTINCT, EVERY VISION SHARED. TOGETHER WE BUILD, DREAM, AND SHAPE THE FUTURE OF FASHION.</p>
            </div>
        </div>
    </main>

    <!-- Sonidos -->
    <audio id="noiseSound" src="assets/sounds/breathing.mp3" preload="auto"></audio>
    <audio id="whispersSound" src="assets/sounds/breathing.mp3" preload="auto"></audio>

    <script>
        window.preloaderEnterPressed = true;
    </script>

    <!-- Load scripts -->
    <script defer src="assets/js/ui-sounds.js"></script>
    <script defer src="assets/js/cursor-effect.js"></script>
    <script src="assets/js/tooltip-nebula.js"></script>
    <script src="assets/js/controls.js"></script>

    <script>
        // Configuración de la galería - Miembros del equipo
        const galleryImages = [
            { 
                src: 'assets/images/team-page/team-erik.jpg', 
                title: 'ERIK BRUCCIA',
                description: 'Creative Director & Founder',
                bio: 'Visionary leader with over 15 years of experience in fashion. Erik founded Eaftimos with the mission to redefine contemporary aesthetics through minimalist design and bold storytelling.',
                details: {
                    location: 'Mexico City',
                    joined: '2015',
                    specialty: 'Brand Strategy & Creative Vision'
                },
                social: {
                    twitter: 'https://twitter.com/eaftimos',
                    instagram: 'https://instagram.com/eaftimos'
                },
                overlayWords: ['VISION', 'CREATE', 'LEAD', 'INSPIRE', 'DESIGN']
            },
            { 
                src: 'assets/images/team-page/team-fran.jpeg', 
                title: 'FRAN',
                description: 'Head of Design',
                bio: 'Master of form and function, Sofia brings architectural precision to every piece. Her work balances innovation with timeless elegance, creating garments that transcend trends.',
                details: {
                    location: 'Barcelona',
                    joined: '2017',
                    specialty: 'Pattern Making & Tailoring'
                },
                social: {
                    twitter: 'https://twitter.com/sofia',
                    instagram: 'https://instagram.com/sofia'
                },
                overlayWords: ['CRAFT', 'DETAIL', 'FORM', 'BEAUTY', 'STRUCTURE']
            },
            { 
                src: 'assets/images/team-page/team-maby.jpeg', 
                title: 'Jose Miguel "Maby" Ortiz',
                description: 'Lead Photographer',
                bio: 'Visual architect of Eaftimos’ universe. Creative visual director with a strong background in filmmaking and digital content. Leads the visual production of Eaftimos, transforming fashion concepts into cinematic narratives that define the brand’s aesthetic and emotional impact.',
                details: {
                    location: 'Almería, Spain',
                    joined: '2024',
                    specialty: 'Editorial & Campaign Photography'
                },
                social: {
                    instagram: 'https://instagram.com/maby.jm'
                },
                overlayWords: ['CAPTURE', 'LIGHT', 'MOMENT', 'FRAME', 'LENS']
            },
            { 
                src: 'assets/images/team-page/team-cris.jpeg', 
                title: 'CRIS GARCÍA',
                description: 'Fashion Stylist',
                bio: 'Emma curates visual poetry through styling. Her intuitive approach creates harmonious compositions that elevate each garment into a complete artistic statement.',
                details: {
                    location: 'London',
                    joined: '2019',
                    specialty: 'Editorial Styling & Art Direction'
                },
                social: {
                    twitter: 'https://twitter.com/emma',
                    instagram: 'https://instagram.com/emma'
                },
                overlayWords: ['STYLE', 'FLOW', 'GRACE', 'ELEGANCE', 'BALANCE']
            },
            { 
                src: 'assets/images/team-page/team-charlie.jpeg', 
                title: 'CHARLIE SÁNCHEZ',
                description: 'Creative Designer',
                bio: 'Obsessive urban culture and couture lover, Charlie orchestrates the digital and visual identity of EAFTIMOS. His multidisciplinary background as game designer, filmmaker and journalist seamlessly blends into his current mindset, designing cohesive brand experiences.',
                details: {
                    location: 'Granada, Spain',
                    joined: '2025',
                    specialty: 'Visual Identity & Brand Design'
                },
                social: {
                    twitter: 'https://twitter.com/charliesnchez',
                    instagram: 'https://www.instagram.com/charliesnchez'
                },
                overlayWords: ['ART', 'VISION', 'COHERENCE', 'DESIGN', 'GAMIFICATION']
            }
        ];

        let currentIndex = 0;
        let isDragging = false;
        let startX = 0;
        let startY = 0;
        let currentX = 0;
        let currentY = 0;
        let dragOffset = 0;
        let currentScale = 1;
        let isZoomed = false;
        let lastTapTime = 0;
        let panX = 0;
        let panY = 0;
        let startPanX = 0;
        let startPanY = 0;
        const SWIPE_THRESHOLD = 100; // Píxeles mínimos para cambiar de imagen
        const MAX_SCALE = 3;
        const MIN_SCALE = 1;

        // Audio para transición de tarjetas
        const swipeSound = new Audio('assets/sounds/web-sfx/Cursor5.mp3');
        swipeSound.volume = 0.3;

        let pageLoaderHidden = false;

        // Only show the loader if loading takes longer than 300ms
        const pageLoaderShowTimer = setTimeout(() => {
            const loader = document.getElementById('pageLoader');
            if (loader && !pageLoaderHidden) {
                loader.classList.remove('page-loader-pending');
            }
        }, 300);

        function hidePageLoader() {
            clearTimeout(pageLoaderShowTimer);
            if (pageLoaderHidden) return;
            const loader = document.getElementById('pageLoader');
            if (!loader) return;
            pageLoaderHidden = true;
            loader.classList.add('hidden');
            loader.setAttribute('aria-busy', 'false');
            setTimeout(() => {
                if (loader.parentNode) loader.parentNode.removeChild(loader);
            }, 600);
        }

        function waitForGalleryImages() {
            const images = Array.from(document.querySelectorAll('#galleryTrack img'));
            if (!images.length) return Promise.resolve();

            const promises = images.map((img) => {
                if (img.complete) return Promise.resolve();
                return new Promise((resolve) => {
                    const done = () => {
                        img.removeEventListener('load', done);
                        img.removeEventListener('error', done);
                        resolve();
                    };
                    img.addEventListener('load', done);
                    img.addEventListener('error', done);
                });
            });

            return Promise.all(promises);
        }

        // Generar tarjetas de galería
        function initGallery() {
            const track = document.getElementById('galleryTrack');
            const progressIndicator = document.getElementById('progressIndicator');

            galleryImages.forEach((image, index) => {
                // Crear tarjeta
                const card = document.createElement('div');
                card.className = 'gallery-card';
                if (index === 0) card.classList.add('active');
                else if (index === 1) card.classList.add('next');
                else card.classList.add('hidden');

                // Las overlay words se crearán fuera de la tarjeta más adelante

                // Crear enlaces sociales
                let socialLinksHTML = '<div class="card-social-links">';
                if (image.social.twitter) {
                    socialLinksHTML += `
                        <a href="${image.social.twitter}" target="_blank" rel="noopener noreferrer" class="social-link" title="Twitter">
                            <svg viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                    `;
                }
                if (image.social.instagram) {
                    socialLinksHTML += `
                        <a href="${image.social.instagram}" target="_blank" rel="noopener noreferrer" class="social-link" title="Instagram">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                    `;
                }
                socialLinksHTML += '</div>';

                // Crear detalles para la parte trasera
                let detailsHTML = '<div class="card-back-details">';
                if (image.details) {
                    detailsHTML += `
                        <div class="card-back-detail">
                            <div class="card-back-detail-label">Hometown:</div>
                            <div class="card-back-detail-value">${image.details.location}</div>
                        </div>
                        <div class="card-back-detail">
                            <div class="card-back-detail-label">Joined:</div>
                            <div class="card-back-detail-value">${image.details.joined}</div>
                        </div>
                        <div class="card-back-detail">
                            <div class="card-back-detail-label">Specialty:</div>
                            <div class="card-back-detail-value">${image.details.specialty}</div>
                        </div>
                    `;
                }
                detailsHTML += '</div>';

                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <img src="${image.src}" alt="${image.title}" draggable="false">
                            <div class="card-info-overlay">
                                <div class="card-title">${image.title}</div>
                                <div class="card-description">${image.description}</div>
                                ${socialLinksHTML}
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-back-content">
                                <div class="card-back-title">${image.title}</div>
                                <div class="card-back-bio">${image.bio || 'No bio available.'}</div>
                                ${detailsHTML}
                                <button class="flip-button" onclick="flipCard(this)">BACK TO FRONT</button>
                            </div>
                        </div>
                    </div>
                `;

                // Crear overlay words fuera de la tarjeta (position fixed)
                const cardOverlayWords = document.createElement('div');
                cardOverlayWords.className = 'card-overlay-words';
                image.overlayWords.forEach(word => {
                    const wordElement = document.createElement('div');
                    wordElement.className = 'overlay-word';
                    wordElement.textContent = word;
                    cardOverlayWords.appendChild(wordElement);
                });
                
                // Añadir overlay words al contenedor global (no a la carta)
                document.getElementById('overlayWordsContainer').appendChild(cardOverlayWords);
                
                // Guardar referencia en la carta
                card.overlayWordsElement = cardOverlayWords;

                track.appendChild(card);
                
                // Iniciar animación de palabras para la primera tarjeta
                if (index === 0) {
                    setTimeout(() => animateCardWords(card), 500);
                }
                
                // Prevenir completamente el arrastre nativo de la imagen
                const img = card.querySelector('img');
                if (img) {
                    img.ondragstart = () => false;
                    img.addEventListener('dragstart', (e) => e.preventDefault());
                    img.addEventListener('contextmenu', (e) => e.preventDefault());
                }

                // Crear punto de progreso
                const dot = document.createElement('div');
                dot.className = 'progress-dot';
                if (index === 0) dot.classList.add('active');
                progressIndicator.appendChild(dot);

                // Event listeners para drag
                const cardInner = card.querySelector('.card-inner');
                cardInner.addEventListener('mousedown', startDrag);
                cardInner.addEventListener('touchstart', startDrag);
                
                // Event listener para clic/tap en la tarjeta (flip)
                let clickStartX = 0;
                let clickStartY = 0;
                let clickStartTime = 0;
                
                cardInner.addEventListener('mousedown', function(e) {
                    clickStartX = e.clientX;
                    clickStartY = e.clientY;
                    clickStartTime = Date.now();
                });
                
                cardInner.addEventListener('touchstart', function(e) {
                    if (e.touches.length === 1) {
                        clickStartX = e.touches[0].clientX;
                        clickStartY = e.touches[0].clientY;
                        clickStartTime = Date.now();
                    }
                }, { passive: true });
                
                cardInner.addEventListener('click', function(e) {
                    // Calcular movimiento desde el mousedown/touchstart
                    const endX = e.clientX || e.changedTouches?.[0]?.clientX || 0;
                    const endY = e.clientY || e.changedTouches?.[0]?.clientY || 0;
                    const moveDistance = Math.sqrt(Math.pow(endX - clickStartX, 2) + Math.pow(endY - clickStartY, 2));
                    const clickDuration = Date.now() - clickStartTime;
                    
                    // Solo flip si no hubo movimiento significativo, no hay zoom, y fue un clic rápido
                    if (moveDistance < 10 && !isZoomed && clickDuration < 300) {
                        // Evitar flip si se hace clic en un enlace social o botón
                        if (e.target.closest('.social-link') || e.target.closest('.flip-button')) {
                            return;
                        }
                        
                        // Solo permitir flip en tarjeta activa
                        if (card.classList.contains('active')) {
                            card.classList.toggle('flipped');
                            
                            // Ocultar/mostrar elementos UI
                            const progressIndicator = document.querySelector('.progress-indicator');
                            const collectionInfo = document.querySelector('.collection-info');
                            
                            if (card.classList.contains('flipped')) {
                                progressIndicator?.classList.add('hidden');
                                collectionInfo?.classList.add('hidden');
                            } else {
                                progressIndicator?.classList.remove('hidden');
                                collectionInfo?.classList.remove('hidden');
                            }
                        }
                    }
                });
            });

            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);

            // Event listeners para pinch zoom
            track.addEventListener('touchstart', handleTouchStart, { passive: false });
            track.addEventListener('touchmove', handleTouchMove, { passive: false });
            track.addEventListener('touchend', handleTouchEnd);
            
            // Event listener para zoom con rueda del ratón
            track.addEventListener('wheel', handleWheel, { passive: false });
            
            // Prevenir arrastre nativo del navegador en las imágenes
            track.addEventListener('dragstart', (e) => {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                }
            });
        }

        // Función global para voltear tarjetas desde el botón
        function flipCard(button) {
            const card = button.closest('.gallery-card');
            if (card) {
                card.classList.remove('flipped');
                
                // Mostrar elementos UI al regresar al frente
                const progressIndicator = document.querySelector('.progress-indicator');
                const collectionInfo = document.querySelector('.collection-info');
                progressIndicator?.classList.remove('hidden');
                collectionInfo?.classList.remove('hidden');
            }
        }

        // Funciones de drag y zoom
        function startDrag(e) {
            const card = e.target.closest('.gallery-card');
            if (card && card.classList.contains('active')) {
                // No permitir arrastre si la tarjeta está volteada
                if (card.classList.contains('flipped')) {
                    return;
                }
                
                // Prevenir comportamiento nativo del navegador
                e.preventDefault();
                e.stopPropagation();
                
                // Detectar doble tap para zoom
                const currentTime = Date.now();
                const tapGap = currentTime - lastTapTime;
                
                if (tapGap < 300 && tapGap > 0 && !card.classList.contains('flipped')) {
                    // Doble tap detectado (solo en cara frontal)
                    toggleZoom(card);
                    lastTapTime = 0;
                    return;
                }
                lastTapTime = currentTime;

                isDragging = true;
                startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
                startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
                
                // Cambiar cursor
                card.style.cursor = 'grabbing';
                document.body.style.cursor = 'grabbing';
                document.body.style.userSelect = 'none';
                
                if (isZoomed) {
                    // Si está zoomeada, guardar posición actual del pan
                    startPanX = panX;
                    startPanY = panY;
                } else {
                    card.classList.add('dragging');
                }
            }
        }

        function drag(e) {
            if (!isDragging) return;

            e.preventDefault();

            currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            currentY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            
            if (isZoomed) {
                // Si está zoomeada, hacer pan con límites
                panX = startPanX + (currentX - startX);
                panY = startPanY + (currentY - startY);
                
                const activeCard = document.querySelector('.gallery-card.active');
                const img = activeCard?.querySelector('img');
                if (img) {
                    // Calcular límites para que la imagen no se salga del contenedor
                    const cardRect = activeCard.getBoundingClientRect();
                    
                    // Usar dimensiones renderizadas de la imagen (sin scale)
                    const imgWidth = img.offsetWidth;
                    const imgHeight = img.offsetHeight;
                    
                    // Dimensiones escaladas de la imagen
                    const scaledWidth = imgWidth * currentScale;
                    const scaledHeight = imgHeight * currentScale;
                    
                    // Calcular el máximo desplazamiento permitido (más restrictivo: 60% del overflow)
                    const maxPanX = Math.max(0, (scaledWidth - cardRect.width) / 2) * 0.6;
                    const maxPanY = Math.max(0, (scaledHeight - cardRect.height) / 2) * 0.6;
                    
                    // Aplicar límites
                    panX = Math.max(-maxPanX, Math.min(maxPanX, panX));
                    panY = Math.max(-maxPanY, Math.min(maxPanY, panY));
                    
                    img.style.transform = `scale(${currentScale}) translate(${panX / currentScale}px, ${panY / currentScale}px)`;
                }
            } else {
                // Si no está zoomeada, swipe normal
                dragOffset = currentX - startX;

                const activeCard = document.querySelector('.gallery-card.active');
                if (activeCard) {
                    const rotation = dragOffset * 0.05;
                    activeCard.style.transform = `translate(-50%, -50%) scale(1.05) translateX(${dragOffset}px) rotate(${rotation}deg)`;
                }
            }
        }

        function endDrag(e) {
            if (!isDragging) return;
            isDragging = false;
            
            // Restaurar cursor
            const activeCard = document.querySelector('.gallery-card.active');
            if (activeCard) {
                activeCard.style.cursor = '';
            }
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
            
            if (isZoomed) {
                // Si está zoomeada, solo terminar el pan
                return;
            }

            if (activeCard) {
                activeCard.classList.remove('dragging');

                // Solo cambiar de imagen si supera el threshold
                if (Math.abs(dragOffset) > SWIPE_THRESHOLD) {
                    if (dragOffset < 0) {
                        // Swipe izquierda (siguiente)
                        activeCard.classList.add('swiping-left');
                        setTimeout(() => nextImage(), 250);
                    } else {
                        // Swipe derecha (también siguiente)
                        activeCard.classList.add('swiping-right');
                        setTimeout(() => nextImage(), 250);
                    }
                } else {
                    // Volver al centro con animación elástica
                    activeCard.classList.add('returning');
                    activeCard.style.transform = 'translate(-50%, -50%) scale(1.05)';
                    setTimeout(() => {
                        activeCard.classList.remove('returning');
                    }, 400);
                }
            }

            dragOffset = 0;
        }

        // Funciones de zoom
        function toggleZoom(card) {
            if (isZoomed) {
                resetZoom();
            } else {
                applyZoom(card);
            }
        }

        function applyZoom(card, scale) {
            isZoomed = true;
            if (scale !== undefined) {
                currentScale = scale;
            } else {
                currentScale = 2;
            }
            // Resetear pan al aplicar zoom
            panX = 0;
            panY = 0;
            const img = card ? card.querySelector('img') : document.querySelector('.gallery-card.active img');
            if (img) {
                img.style.transform = `scale(${currentScale})`;
                if (card) card.classList.add('zoomed');
            }
            hideUIElements();
        }

        function resetZoom() {
            isZoomed = false;
            currentScale = 1;
            panX = 0;
            panY = 0;
            const activeCard = document.querySelector('.gallery-card.active');
            if (activeCard) {
                const img = activeCard.querySelector('img');
                if (img) {
                    img.style.transform = `scale(1)`;
                }
                activeCard.classList.remove('zoomed');
            }
            showUIElements();
        }

        function hideUIElements() {
            document.querySelector('.collection-info')?.classList.add('hidden');
            document.querySelector('.progress-indicator')?.classList.add('hidden');
            // Ocultar el overlay de información de la tarjeta activa
            const activeCard = document.querySelector('.gallery-card.active');
            if (activeCard) {
                const cardInfo = activeCard.querySelector('.card-info-overlay');
                if (cardInfo) cardInfo.style.opacity = '0';
                // Ocultar palabras overlay cuando hay zoom
                const overlayWords = activeCard.querySelector('.card-overlay-words');
                if (overlayWords) overlayWords.style.opacity = '0';
            }
        }

        function showUIElements() {
            document.querySelector('.collection-info')?.classList.remove('hidden');
            document.querySelector('.progress-indicator')?.classList.remove('hidden');
            // Mostrar el overlay de información de la tarjeta activa
            const activeCard = document.querySelector('.gallery-card.active');
            if (activeCard && !activeCard.classList.contains('flipped')) {
                const cardInfo = activeCard.querySelector('.card-info-overlay');
                if (cardInfo) cardInfo.style.opacity = '1';
                // Mostrar palabras overlay
                const overlayWords = activeCard.querySelector('.card-overlay-words');
                if (overlayWords) overlayWords.style.opacity = '1';
            }
        }

        // Soporte para pinch zoom en móviles
        let initialDistance = 0;
        let initialScale = 1;

        function handleTouchStart(e) {
            if (e.touches.length === 2) {
                e.preventDefault();
                initialDistance = getDistance(e.touches[0], e.touches[1]);
                initialScale = currentScale;
            }
        }

        function handleTouchMove(e) {
            if (e.touches.length === 2) {
                e.preventDefault();
                const currentDistance = getDistance(e.touches[0], e.touches[1]);
                const scale = (currentDistance / initialDistance) * initialScale;
                
                currentScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, scale));
                
                const activeCard = document.querySelector('.gallery-card.active');
                if (activeCard) {
                    const img = activeCard.querySelector('img');
                    if (img) {
                        // Calcular límites para el pan con el nuevo scale
                        const cardRect = activeCard.getBoundingClientRect();
                        
                        // Usar dimensiones renderizadas de la imagen
                        const imgWidth = img.offsetWidth;
                        const imgHeight = img.offsetHeight;
                        
                        const scaledWidth = imgWidth * currentScale;
                        const scaledHeight = imgHeight * currentScale;
                        
                        // Límites más restrictivos: 60% del overflow
                        const maxPanX = Math.max(0, (scaledWidth - cardRect.width) / 2) * 0.6;
                        const maxPanY = Math.max(0, (scaledHeight - cardRect.height) / 2) * 0.6;
                        
                        // Ajustar pan a los límites
                        panX = Math.max(-maxPanX, Math.min(maxPanX, panX));
                        panY = Math.max(-maxPanY, Math.min(maxPanY, panY));
                        
                        img.style.transform = `scale(${currentScale}) translate(${panX / currentScale}px, ${panY / currentScale}px)`;
                    }
                    
                    if (currentScale > 1.1 && !isZoomed) {
                        isZoomed = true;
                        activeCard.classList.add('zoomed');
                        hideUIElements();
                    } else if (currentScale <= 1.05 && isZoomed) {
                        resetZoom();
                    }
                }
            }
        }

        function handleTouchEnd(e) {
            if (e.touches.length < 2) {
                initialDistance = 0;
                if (currentScale < 1.1) {
                    resetZoom();
                }
            }
        }

        function getDistance(touch1, touch2) {
            const dx = touch1.clientX - touch2.clientX;
            const dy = touch1.clientY - touch2.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        function handleWheel(e) {
            const activeCard = document.querySelector('.gallery-card.active');
            if (!activeCard) return;
            
            const img = activeCard.querySelector('img');
            if (!img) return;
            
            e.preventDefault();
            
            // Obtener posición del cursor relativa a la imagen
            const rect = img.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // Normalizar coordenadas (0 a 1)
            const normalizedX = mouseX / rect.width;
            const normalizedY = mouseY / rect.height;
            
            // Guardar escala anterior
            const oldScale = currentScale;
            
            // Determinar dirección del scroll (positivo = zoom out, negativo = zoom in)
            const delta = e.deltaY;
            const zoomStep = 0.15; // Mayor sensibilidad
            
            if (delta < 0) {
                // Scroll up = zoom in
                if (currentScale < MAX_SCALE) {
                    // Calcular nuevo scale
                    const newScale = Math.min(currentScale + zoomStep, MAX_SCALE);
                    
                    // Zoom focal: mantener el punto bajo el cursor fijo
                    // Obtener el punto del cursor relativo al centro de la imagen en pantalla
                    const imgCenterX = rect.width / 2;
                    const imgCenterY = rect.height / 2;
                    const offsetX = mouseX - imgCenterX;
                    const offsetY = mouseY - imgCenterY;
                    
                    // Fórmula correcta para zoom focal:
                    // new_pan = (cursor_offset - old_pan) * (new_scale / old_scale) + old_pan - cursor_offset * (new_scale - old_scale)
                    // Simplificado: new_pan = old_pan - cursor_offset * (new_scale / old_scale - 1)
                    const scaleRatio = newScale / currentScale;
                    panX = panX - offsetX * (scaleRatio - 1);
                    panY = panY - offsetY * (scaleRatio - 1);
                    
                    currentScale = newScale;
                    
                    img.style.transform = `scale(${currentScale}) translate(${panX / currentScale}px, ${panY / currentScale}px)`;
                    isZoomed = true;
                    activeCard.classList.add('zoomed');
                    if (currentScale > MIN_SCALE) {
                        hideUIElements();
                    }
                }
            } else {
                // Scroll down = zoom out
                if (currentScale > MIN_SCALE) {
                    const oldScale = currentScale;
                    currentScale = Math.max(currentScale - zoomStep, MIN_SCALE);
                    const newScale = currentScale;
                    
                    // Obtener posición del cursor relativa a la imagen
                    const imgRect = img.getBoundingClientRect();
                    const mouseX = e.clientX - imgRect.left;
                    const mouseY = e.clientY - imgRect.top;
                    
                    // Centro de la imagen
                    const imgCenterX = imgRect.width / 2;
                    const imgCenterY = imgRect.height / 2;
                    
                    // Offset desde el centro hasta el cursor
                    const offsetX = mouseX - imgCenterX;
                    const offsetY = mouseY - imgCenterY;
                    
                    // Aplicar fórmula focal point
                    const scaleRatio = newScale / oldScale;
                    const focalPanX = panX - offsetX * (scaleRatio - 1);
                    const focalPanY = panY - offsetY * (scaleRatio - 1);
                    
                    // Factor de interpolación: 0 cuando está cerca de MIN_SCALE, 1 cuando está cerca de MAX_SCALE
                    const zoomRange = MAX_SCALE - MIN_SCALE;
                    const currentZoomOffset = currentScale - MIN_SCALE;
                    const interpolationFactor = Math.pow(currentZoomOffset / zoomRange, 1.5); // Exponente para suavizar transición
                    
                    // Interpolar entre focal point y centro (0, 0)
                    panX = focalPanX * interpolationFactor;
                    panY = focalPanY * interpolationFactor;
                    
                    img.style.transform = `scale(${currentScale}) translate(${panX / currentScale}px, ${panY / currentScale}px)`;
                    if (currentScale <= MIN_SCALE) {
                        isZoomed = false;
                        activeCard.classList.remove('zoomed');
                        panX = 0;
                        panY = 0;
                        img.style.transform = `scale(1)`;
                        showUIElements();
                    }
                }
            }
        }

        // Navegación
        function updateCards() {
            // Resetear zoom al cambiar de imagen
            resetZoom();

            const cards = document.querySelectorAll('.gallery-card');
            const dots = document.querySelectorAll('.progress-dot');

            cards.forEach((card, index) => {
                card.classList.remove('active', 'next', 'hidden', 'swiping-left', 'swiping-right', 'returning', 'coming-from-back', 'moving-forward', 'moving-to-back', 'flipped');
                // Resetear transform inline para permitir que CSS tome control
                card.style.transform = '';
                
                // Resetear zoom de la imagen
                const img = card.querySelector('img');
                if (img) {
                    img.style.transform = 'scale(1)';
                }

                // Detener animación de palabras de tarjetas no activas
                stopCardWords(card);

                if (index === currentIndex) {
                    card.classList.add('active');
                    // Iniciar animación de palabras de la tarjeta activa
                    setTimeout(() => animateCardWords(card), 300);
                } else if (index === currentIndex + 1 || (currentIndex === galleryImages.length - 1 && index === 0)) {
                    card.classList.add('next');
                } else {
                    card.classList.add('hidden');
                }
            });

            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });
        }

        // Animar las palabras overlay de una tarjeta específica
        function animateCardWords(card) {
            if (!card.overlayWordsElement) return;
            const words = card.overlayWordsElement.querySelectorAll('.overlay-word');
            if (!words.length) return;

            let currentWordIndex = 0;

            function showNextWord() {
                // Desvanecer la palabra actual suavemente
                words.forEach(word => {
                    if (word.classList.contains('active')) {
                        word.classList.remove('active');
                        word.classList.add('fading');
                    }
                });

                // Mostrar la siguiente palabra después de la transición
                setTimeout(() => {
                    words.forEach(word => word.classList.remove('fading'));
                    words[currentWordIndex].classList.add('active');
                    currentWordIndex = (currentWordIndex + 1) % words.length;
                }, 700);
            }

            // Mostrar primera palabra inmediatamente
            words[0].classList.add('active');
            currentWordIndex = 1;

            // Guardar intervalo en la tarjeta para poder limpiarlo
            if (card.wordInterval) clearInterval(card.wordInterval);
            card.wordInterval = setInterval(showNextWord, 4500);
        }

        // Detener animación de palabras de una tarjeta suavemente
        function stopCardWords(card) {
            if (card.wordInterval) {
                clearInterval(card.wordInterval);
                card.wordInterval = null;
            }
            if (!card.overlayWordsElement) return;
            const words = card.overlayWordsElement.querySelectorAll('.overlay-word');
            // Desactivar suavemente sin poppeos
            words.forEach(word => {
                if (word.classList.contains('active')) {
                    word.classList.add('fading');
                }
                // Remover clases después de la transición
                setTimeout(() => {
                    word.classList.remove('active', 'fading');
                }, 1400);
            });
        }

        function nextImage() {
            // Reproducir sonido de transición
            if (swipeSound && !swipeSound.paused) {
                swipeSound.currentTime = 0;
            }
            swipeSound.play().catch(e => console.log('Audio play prevented:', e));

            currentIndex = (currentIndex + 1) % galleryImages.length;
            updateCards();
        }

        function prevImage() {
            // Reproducir sonido de transición
            if (swipeSound && !swipeSound.paused) {
                swipeSound.currentTime = 0;
            }
            swipeSound.play().catch(e => console.log('Audio play prevented:', e));

            // Calcular el índice de la imagen anterior
            const prevIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
            const cards = document.querySelectorAll('.gallery-card');
            const prevCard = cards[prevIndex];
            const oldCurrentIndex = currentIndex;
            const currentCard = cards[oldCurrentIndex];
            
            // Convertir inmediatamente la tarjeta actual a "next" sin animación
            currentCard.style.transition = 'none';
            currentCard.classList.remove('active');
            currentCard.classList.add('next');
            currentCard.offsetHeight; // Force reflow
            
            // Preparar la tarjeta anterior con estado inicial (pequeña, a la izquierda, rotada, desde atrás)
            prevCard.classList.remove('hidden', 'next');
            prevCard.classList.add('coming-from-back');
            
            // Forzar reflow para que la transición funcione
            prevCard.offsetHeight;
            
            // Actualizar el índice
            currentIndex = prevIndex;
            
            // Animar la tarjeta hacia adelante desde la izquierda con rotación
            setTimeout(() => {
                prevCard.classList.add('moving-forward', 'active');
                
                // Restaurar transiciones de la tarjeta que ahora es "next"
                setTimeout(() => {
                    currentCard.style.transition = '';
                }, 50);
                
                // Actualizar el resto de tarjetas después de la animación
                setTimeout(() => {
                    // Limpiar clases de animación de la tarjeta que acaba de llegar
                    prevCard.classList.remove('coming-from-back', 'moving-forward');
                    
                    // Actualizar solo las tarjetas restantes que necesitan cambiar de estado
                    cards.forEach((card, index) => {
                        // Excluir la tarjeta actual (nueva activa) y la que era la activa (ahora next)
                        if (index !== currentIndex && index !== oldCurrentIndex) {
                            // Remover clases de animación
                            card.classList.remove('active', 'coming-from-back', 'moving-forward', 'moving-to-back');
                            
                            // Determinar el nuevo estado correcto
                            const shouldBeNext = (index === currentIndex + 1) || (currentIndex === galleryImages.length - 1 && index === 0);
                            const isNext = card.classList.contains('next');
                            const isHidden = card.classList.contains('hidden');
                            
                            // Solo cambiar estado si es necesario y desactivar transiciones temporalmente
                            if (shouldBeNext && !isNext) {
                                // Cambiar de hidden a next
                                card.style.transition = 'none';
                                card.classList.remove('hidden');
                                card.classList.add('next');
                                card.offsetHeight; // Force reflow
                                card.style.transition = '';
                            } else if (!shouldBeNext && !isHidden) {
                                // Cambiar de next a hidden
                                card.style.transition = 'none';
                                card.classList.remove('next');
                                card.classList.add('hidden');
                                card.offsetHeight; // Force reflow
                                card.style.transition = '';
                            }
                        }
                    });
                }, 500);
                
                // Actualizar dots
                const dots = document.querySelectorAll('.progress-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentIndex);
                });
                
            }, 20);
        }

        // Soporte para teclado - navegación con flechas
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') {
                const activeCard = document.querySelector('.gallery-card.active');
                if (activeCard) {
                    activeCard.classList.add('swiping-right');
                    setTimeout(() => nextImage(), 250);
                }
            } else if (e.key === 'ArrowLeft') {
                const activeCard = document.querySelector('.gallery-card.active');
                if (activeCard) {
                    activeCard.classList.add('swiping-left');
                    setTimeout(() => prevImage(), 250);
                }
            }
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            initGallery();
            waitForGalleryImages().then(() => {
                requestAnimationFrame(hidePageLoader);
            });
        });

        // Fallback si alguna imagen tarda demasiado
        window.addEventListener('load', () => {
            setTimeout(hidePageLoader, 1500);
        });

        // Fade-in blanco al entrar
        window.addEventListener('load', function() {
            var overlay = document.getElementById('entryWhiteOverlay');
            if (overlay) {
                setTimeout(function() {
                    overlay.style.opacity = '0';
                    setTimeout(function() {
                        overlay.parentNode && overlay.parentNode.removeChild(overlay);
                    }, 380);
                }, 10);
            }
        });

        // Overlay fade blanco al hacer click en el logo
        document.addEventListener('DOMContentLoaded', function() {
            var logoLink = document.querySelector('a.logo');
            if (logoLink) {
                logoLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Fade out del audio
                    const noiseSound = document.getElementById('noiseSound');
                    const whispersSound = document.getElementById('whispersSound');
                    const fadeDuration = 300;
                    const startTime = performance.now();
                    
                    function fadeOutAudio() {
                        const elapsed = performance.now() - startTime;
                        const progress = Math.min(1, elapsed / fadeDuration);
                        const eased = 1 - Math.pow(1 - progress, 3);
                        const volume = 1 - eased;
                        
                        if (noiseSound && window.noiseGain) {
                            window.noiseGain.gain.value *= volume;
                        }
                        
                        if (whispersSound && window.whispersGain) {
                            window.whispersGain.gain.value *= volume;
                        }
                        
                        if (progress < 1) {
                            requestAnimationFrame(fadeOutAudio);
                        } else {
                            if (noiseSound) noiseSound.pause();
                            if (whispersSound) whispersSound.pause();
                        }
                    }
                    
                    fadeOutAudio();
                    
                    // Crear overlay blanco
                    var overlay = document.createElement('div');
                    overlay.style.position = 'fixed';
                    overlay.style.top = '0';
                    overlay.style.left = '0';
                    overlay.style.width = '100vw';
                    overlay.style.height = '100vh';
                    overlay.style.background = '#fff';
                    overlay.style.zIndex = '250000';
                    overlay.style.pointerEvents = 'auto';
                    overlay.style.transition = 'opacity 0.38s cubic-bezier(.77,0,.18,1)';
                    overlay.style.opacity = '0';
                    document.body.appendChild(overlay);
                    void overlay.offsetWidth;
                    overlay.style.opacity = '1';
                    
                    setTimeout(function() {
                        window.location.href = logoLink.href;
                    }, 320);
                });
            }
        });
    </script>
</body>

</html>
